<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>fs/index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="perf.PerfData.html">PerfData</a><ul class='methods'><li data-type='method'><a href="perf.PerfData.html#end">end</a></li><li data-type='method'><a href="perf.PerfData.html#lap">lap</a></li><li data-type='method'><a href="perf.PerfData.html#report">report</a></li></ul></li><li><a href="shell.Proc.html">Proc</a><ul class='methods'><li data-type='method'><a href="shell.Proc.html#dir">dir</a></li><li data-type='method'><a href="shell.Proc.html#do">do</a></li><li data-type='method'><a href="shell.Proc.html#env">env</a></li><li data-type='method'><a href="shell.Proc.html#pipe">pipe</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-errno.html">errno</a><ul class='members'><li data-type='member'><a href="module-errno.html#.E2BIG">E2BIG</a></li><li data-type='member'><a href="module-errno.html#.EACCES">EACCES</a></li><li data-type='member'><a href="module-errno.html#.EAGAIN">EAGAIN</a></li><li data-type='member'><a href="module-errno.html#.EBADF">EBADF</a></li><li data-type='member'><a href="module-errno.html#.EBUSY">EBUSY</a></li><li data-type='member'><a href="module-errno.html#.ECHILD">ECHILD</a></li><li data-type='member'><a href="module-errno.html#.EDOM">EDOM</a></li><li data-type='member'><a href="module-errno.html#.EEXIST">EEXIST</a></li><li data-type='member'><a href="module-errno.html#.EFAULT">EFAULT</a></li><li data-type='member'><a href="module-errno.html#.EFBIG">EFBIG</a></li><li data-type='member'><a href="module-errno.html#.EINTR">EINTR</a></li><li data-type='member'><a href="module-errno.html#.EINVAL">EINVAL</a></li><li data-type='member'><a href="module-errno.html#.EIO">EIO</a></li><li data-type='member'><a href="module-errno.html#.EISDIR">EISDIR</a></li><li data-type='member'><a href="module-errno.html#.EMFILE">EMFILE</a></li><li data-type='member'><a href="module-errno.html#.EMLINK">EMLINK</a></li><li data-type='member'><a href="module-errno.html#.ENFILE">ENFILE</a></li><li data-type='member'><a href="module-errno.html#.ENODEV">ENODEV</a></li><li data-type='member'><a href="module-errno.html#.ENOENT">ENOENT</a></li><li data-type='member'><a href="module-errno.html#.ENOEXEC">ENOEXEC</a></li><li data-type='member'><a href="module-errno.html#.ENOMEM">ENOMEM</a></li><li data-type='member'><a href="module-errno.html#.ENOSPC">ENOSPC</a></li><li data-type='member'><a href="module-errno.html#.ENOTBLK">ENOTBLK</a></li><li data-type='member'><a href="module-errno.html#.ENOTDIR">ENOTDIR</a></li><li data-type='member'><a href="module-errno.html#.ENOTTY">ENOTTY</a></li><li data-type='member'><a href="module-errno.html#.ENXIO">ENXIO</a></li><li data-type='member'><a href="module-errno.html#.EPERM">EPERM</a></li><li data-type='member'><a href="module-errno.html#.EPIPE">EPIPE</a></li><li data-type='member'><a href="module-errno.html#.ERANGE">ERANGE</a></li><li data-type='member'><a href="module-errno.html#.EROFS">EROFS</a></li><li data-type='member'><a href="module-errno.html#.ESPIPE">ESPIPE</a></li><li data-type='member'><a href="module-errno.html#.ESRCH">ESRCH</a></li><li data-type='member'><a href="module-errno.html#.ETXTBSY">ETXTBSY</a></li><li data-type='member'><a href="module-errno.html#.EXDEV">EXDEV</a></li></ul><ul class='methods'><li data-type='method'><a href="module-errno.html#.fail">fail</a></li></ul></li><li><a href="module-fs.html">fs</a><ul class='members'><li data-type='member'><a href="module-fs.html#.S_IFBLK">S_IFBLK</a></li><li data-type='member'><a href="module-fs.html#.S_IFCHR">S_IFCHR</a></li><li data-type='member'><a href="module-fs.html#.S_IFDIR">S_IFDIR</a></li><li data-type='member'><a href="module-fs.html#.S_IFIFO">S_IFIFO</a></li><li data-type='member'><a href="module-fs.html#.S_IFLNK">S_IFLNK</a></li><li data-type='member'><a href="module-fs.html#.S_IFMT">S_IFMT</a></li><li data-type='member'><a href="module-fs.html#.S_IFREG">S_IFREG</a></li><li data-type='member'><a href="module-fs.html#.S_IFSOC">S_IFSOC</a></li></ul><ul class='methods'><li data-type='method'><a href="module-fs.html#.basename">basename</a></li><li data-type='method'><a href="module-fs.html#.copy_file">copy_file</a></li><li data-type='method'><a href="module-fs.html#.create_temp_file">create_temp_file</a></li><li data-type='method'><a href="module-fs.html#.dirname">dirname</a></li><li data-type='method'><a href="module-fs.html#.exists">exists</a></li><li data-type='method'><a href="module-fs.html#.is_block_device">is_block_device</a></li><li data-type='method'><a href="module-fs.html#.is_char_device">is_char_device</a></li><li data-type='method'><a href="module-fs.html#.is_directory">is_directory</a></li><li data-type='method'><a href="module-fs.html#.is_executable">is_executable</a></li><li data-type='method'><a href="module-fs.html#.is_fifo">is_fifo</a></li><li data-type='method'><a href="module-fs.html#.is_file">is_file</a></li><li data-type='method'><a href="module-fs.html#.is_link">is_link</a></li><li data-type='method'><a href="module-fs.html#.is_readable">is_readable</a></li><li data-type='method'><a href="module-fs.html#.is_socket">is_socket</a></li><li data-type='method'><a href="module-fs.html#.is_writable">is_writable</a></li><li data-type='method'><a href="module-fs.html#.list_dir">list_dir</a></li><li data-type='method'><a href="module-fs.html#.mkdir">mkdir</a></li><li data-type='method'><a href="module-fs.html#.mkdirp">mkdirp</a></li><li data-type='method'><a href="module-fs.html#.mkfifo">mkfifo</a></li><li data-type='method'><a href="module-fs.html#.normalize_path">normalize_path</a></li><li data-type='method'><a href="module-fs.html#.read_file">read_file</a></li><li data-type='method'><a href="module-fs.html#.read_link">read_link</a></li><li data-type='method'><a href="module-fs.html#.realpath">realpath</a></li><li data-type='method'><a href="module-fs.html#.rmdir">rmdir</a></li><li data-type='method'><a href="module-fs.html#.stat">stat</a></li><li data-type='method'><a href="module-fs.html#.unlink">unlink</a></li><li data-type='method'><a href="module-fs.html#.write_file">write_file</a></li></ul></li><li><a href="module-io.html">io</a><ul class='members'><li data-type='member'><a href="module-io.html#.POLLERR">POLLERR</a></li><li data-type='member'><a href="module-io.html#.POLLHUP">POLLHUP</a></li><li data-type='member'><a href="module-io.html#.POLLIN">POLLIN</a></li><li data-type='member'><a href="module-io.html#.POLLMSG">POLLMSG</a></li><li data-type='member'><a href="module-io.html#.POLLNVAL">POLLNVAL</a></li><li data-type='member'><a href="module-io.html#.POLLOUT">POLLOUT</a></li><li data-type='member'><a href="module-io.html#.POLLPRI">POLLPRI</a></li><li data-type='member'><a href="module-io.html#.POLLRDBAND">POLLRDBAND</a></li><li data-type='member'><a href="module-io.html#.POLLRDHUP">POLLRDHUP</a></li><li data-type='member'><a href="module-io.html#.POLLRDNORM">POLLRDNORM</a></li><li data-type='member'><a href="module-io.html#.POLLREMOVE">POLLREMOVE</a></li><li data-type='member'><a href="module-io.html#.POLLWRBAND">POLLWRBAND</a></li><li data-type='member'><a href="module-io.html#.POLLWRNORM">POLLWRNORM</a></li><li data-type='member'><a href="module-io.html#.SEEK_CUR">SEEK_CUR</a></li><li data-type='member'><a href="module-io.html#.SEEK_END">SEEK_END</a></li><li data-type='member'><a href="module-io.html#.SEEK_SET">SEEK_SET</a></li></ul><ul class='methods'><li data-type='method'><a href="module-io.html#.append">append</a></li><li data-type='method'><a href="module-io.html#.close">close</a></li><li data-type='method'><a href="module-io.html#.create">create</a></li><li data-type='method'><a href="module-io.html#.dup">dup</a></li><li data-type='method'><a href="module-io.html#.dup2">dup2</a></li><li data-type='method'><a href="module-io.html#.open">open</a></li><li data-type='method'><a href="module-io.html#.pipe">pipe</a></li><li data-type='method'><a href="module-io.html#.poll">poll</a></li><li data-type='method'><a href="module-io.html#.read">read</a></li><li data-type='method'><a href="module-io.html#.read_fully">read_fully</a></li><li data-type='method'><a href="module-io.html#.read_string">read_string</a></li><li data-type='method'><a href="module-io.html#.seek">seek</a></li><li data-type='method'><a href="module-io.html#.tell">tell</a></li><li data-type='method'><a href="module-io.html#.truncate">truncate</a></li><li data-type='method'><a href="module-io.html#.write">write</a></li><li data-type='method'><a href="module-io.html#.write_string">write_string</a></li></ul></li><li><a href="module-kern.html">kern</a><ul class='members'><li data-type='member'><a href="module-kern.html#.printk">printk</a></li><li data-type='member'><a href="module-kern.html#.search_path">search_path</a></li><li data-type='member'><a href="module-kern.html#.version">version</a></li></ul></li><li><a href="module-math.html">math</a><ul class='methods'><li data-type='method'><a href="module-math.html#.get_random_bytes">get_random_bytes</a></li></ul></li><li><a href="module-perf.html">perf</a><ul class='methods'><li data-type='method'><a href="module-perf.html#.start">start</a></li></ul></li><li><a href="module-proc.html">proc</a><ul class='members'><li data-type='member'><a href="module-proc.html#.SIGABRT">SIGABRT</a></li><li data-type='member'><a href="module-proc.html#.SIGALRM">SIGALRM</a></li><li data-type='member'><a href="module-proc.html#.SIGBUS">SIGBUS</a></li><li data-type='member'><a href="module-proc.html#.SIGCHLD">SIGCHLD</a></li><li data-type='member'><a href="module-proc.html#.SIGCONT">SIGCONT</a></li><li data-type='member'><a href="module-proc.html#.SIGFPE">SIGFPE</a></li><li data-type='member'><a href="module-proc.html#.SIGHUP">SIGHUP</a></li><li data-type='member'><a href="module-proc.html#.SIGILL">SIGILL</a></li><li data-type='member'><a href="module-proc.html#.SIGINT">SIGINT</a></li><li data-type='member'><a href="module-proc.html#.SIGIO">SIGIO</a></li><li data-type='member'><a href="module-proc.html#.SIGIOT">SIGIOT</a></li><li data-type='member'><a href="module-proc.html#.SIGKILL">SIGKILL</a></li><li data-type='member'><a href="module-proc.html#.SIGPIPE">SIGPIPE</a></li><li data-type='member'><a href="module-proc.html#.SIGPOLL">SIGPOLL</a></li><li data-type='member'><a href="module-proc.html#.SIGPROF">SIGPROF</a></li><li data-type='member'><a href="module-proc.html#.SIGPWR">SIGPWR</a></li><li data-type='member'><a href="module-proc.html#.SIGQUIT">SIGQUIT</a></li><li data-type='member'><a href="module-proc.html#.SIGSEGV">SIGSEGV</a></li><li data-type='member'><a href="module-proc.html#.SIGSTKFLT">SIGSTKFLT</a></li><li data-type='member'><a href="module-proc.html#.SIGSTOP">SIGSTOP</a></li><li data-type='member'><a href="module-proc.html#.SIGSYS">SIGSYS</a></li><li data-type='member'><a href="module-proc.html#.SIGTERM">SIGTERM</a></li><li data-type='member'><a href="module-proc.html#.SIGTRAP">SIGTRAP</a></li><li data-type='member'><a href="module-proc.html#.SIGTSTP">SIGTSTP</a></li><li data-type='member'><a href="module-proc.html#.SIGTTIN">SIGTTIN</a></li><li data-type='member'><a href="module-proc.html#.SIGTTOU">SIGTTOU</a></li><li data-type='member'><a href="module-proc.html#.SIGUNUSED">SIGUNUSED</a></li><li data-type='member'><a href="module-proc.html#.SIGURG">SIGURG</a></li><li data-type='member'><a href="module-proc.html#.SIGUSR1">SIGUSR1</a></li><li data-type='member'><a href="module-proc.html#.SIGUSR2">SIGUSR2</a></li><li data-type='member'><a href="module-proc.html#.SIGVTALRM">SIGVTALRM</a></li><li data-type='member'><a href="module-proc.html#.SIGWINCH">SIGWINCH</a></li><li data-type='member'><a href="module-proc.html#.SIGXCPU">SIGXCPU</a></li><li data-type='member'><a href="module-proc.html#.SIGXFSZ">SIGXFSZ</a></li><li data-type='member'><a href="module-proc.html#.WCONTINUED">WCONTINUED</a></li><li data-type='member'><a href="module-proc.html#.WNOHANG">WNOHANG</a></li><li data-type='member'><a href="module-proc.html#.WUNTRACED">WUNTRACED</a></li></ul><ul class='methods'><li data-type='method'><a href="module-proc.html#.alarm">alarm</a></li><li data-type='method'><a href="module-proc.html#.atexit">atexit</a></li><li data-type='method'><a href="module-proc.html#.chdir">chdir</a></li><li data-type='method'><a href="module-proc.html#.exec">exec</a></li><li data-type='method'><a href="module-proc.html#.exit">exit</a></li><li data-type='method'><a href="module-proc.html#.fork">fork</a></li><li data-type='method'><a href="module-proc.html#.fork2">fork2</a></li><li data-type='method'><a href="module-proc.html#.getegid">getegid</a></li><li data-type='method'><a href="module-proc.html#.getenv">getenv</a></li><li data-type='method'><a href="module-proc.html#.geteuid">geteuid</a></li><li data-type='method'><a href="module-proc.html#.getgid">getgid</a></li><li data-type='method'><a href="module-proc.html#.getpid">getpid</a></li><li data-type='method'><a href="module-proc.html#.getuid">getuid</a></li><li data-type='method'><a href="module-proc.html#.kill">kill</a></li><li data-type='method'><a href="module-proc.html#.setenv">setenv</a></li><li data-type='method'><a href="module-proc.html#.setsid">setsid</a></li><li data-type='method'><a href="module-proc.html#.signal">signal</a></li><li data-type='method'><a href="module-proc.html#.sleep">sleep</a></li><li data-type='method'><a href="module-proc.html#.unsetenv">unsetenv</a></li><li data-type='method'><a href="module-proc.html#.waitpid">waitpid</a></li></ul></li><li><a href="module-shell.html">shell</a><ul class='methods'><li data-type='method'><a href="module-shell.html#.$">$</a></li><li data-type='method'><a href="module-shell.html#.capture">capture</a></li><li data-type='method'><a href="module-shell.html#.file">file</a></li><li data-type='method'><a href="module-shell.html#.here">here</a></li><li data-type='method'><a href="module-shell.html#.search_path">search_path</a></li></ul></li><li><a href="module-stream.html">stream</a><ul class='methods'><li data-type='method'><a href="module-stream.html#.create">create</a></li><li data-type='method'><a href="module-stream.html#.read_line">read_line</a></li><li data-type='method'><a href="module-stream.html#.read_until">read_until</a></li></ul></li><li><a href="module-term.html">term</a><ul class='methods'><li data-type='method'><a href="module-term.html#.bg">bg</a></li><li data-type='method'><a href="module-term.html#.clear">clear</a></li><li data-type='method'><a href="module-term.html#.fg">fg</a></li><li data-type='method'><a href="module-term.html#.hide_cursor">hide_cursor</a></li><li data-type='method'><a href="module-term.html#.move_to">move_to</a></li><li data-type='method'><a href="module-term.html#.print">print</a></li><li data-type='method'><a href="module-term.html#.print2">print2</a></li><li data-type='method'><a href="module-term.html#.println">println</a></li><li data-type='method'><a href="module-term.html#.println2">println2</a></li><li data-type='method'><a href="module-term.html#.read_line">read_line</a></li><li data-type='method'><a href="module-term.html#.reset">reset</a></li><li data-type='method'><a href="module-term.html#.show_cursor">show_cursor</a></li><li data-type='method'><a href="module-term.html#.to_string">to_string</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="Redirection.html">Redirection</a><ul class='methods'><li data-type='method'><a href="Redirection.html#close">close</a></li><li data-type='method'><a href="Redirection.html#open">open</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#ListDirCallback">ListDirCallback</a></li><li><a href="global.html#Pollfd">Pollfd</a></li><li><a href="global.html#ProcExecOptions">ProcExecOptions</a></li><li><a href="global.html#ProcResult">ProcResult</a></li><li><a href="global.html#StatBuf">StatBuf</a></li><li><a href="global.html#SysError">SysError</a></li><li><a href="global.html#TimeSpec">TimeSpec</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">fs/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const errno = require('errno');
const io = require('io');
const math = require('math');
const proc = require('proc');

/**
 * Return from {module:fs.stat} function holding information of a file node
 *
 * @typedef {object} StatBuf
 * @property {number} gid Owner group id
 * @property {number} mode File type and access mode
 * @property {number} size Size in bytes
 * @property {TimeSpec} time Time statistics
 * @property {number} uid Owner user id
 *
 * @see {@link module:fs.S_IFMT}
 * @see {@link module:fs.S_IFBLK}
 * @see {@link module:fs.S_IFCHR}
 * @see {@link module:fs.S_IFDIR}
 * @see {@link module:fs.S_IFIFO}
 * @see {@link module:fs.S_IFLNK}
 * @see {@link module:fs.S_IFREG}
 * @see {@link module:fs.S_IFSOC}
 */

/**
 * Time statistics of a file node (with a resolution of one second)
 *
 * @typedef {object} TimeSpec
 * @property {number} access Last access time 
 * @property {number} creation Creation time 
 * @property {number} modification Last modification time 
 */

/**
 * Callback for {@link module:fs.list_dir} method
 *
 * @callback ListDirCallback
 * @param {string} item Directory item (file name)
 * @param {number} index Index of item in directory
 * @returns {boolean|undefined} Return `false` to stop listing
 */

const decoder = new TextDecoder();

/** 
 * @exports fs 
 * @readonly
 * @enum {number}
 */
const fs = {
	/* stat flags */

	/** Used to &amp; return of {@link module:fs.stat} to extract inode type */
	S_IFMT:  0170000,
	/** File node type: block device */
	S_IFBLK: 0060000,
	/** File node type: char device */
	S_IFCHR: 0020000,
	/** File node type: directory */
	S_IFDIR: 0040000,
	/** File node type: FIFO */
	S_IFIFO: 0010000,
	/** File node type: symbolic link */
	S_IFLNK: 0120000,
	/** File node type: regular file */
	S_IFREG: 0100000,
	/** File node type: socket */
	S_IFSOC: 0140000
};

/**
 * Get the filename part of a path
 *
 * @param {string} path
 * @returns {string} 
 */
fs.basename = function(path) {
	return path.substring(1 + path.lastIndexOf('/'));
}

/**
 * Copy file.
 *
 * Note that if the copy fails, the target file is left in an undefined state.
 *
 * @param {string} from Source file path
 * @param {string} to Destination file path
 * 
 * @param {number} [mode=same as source file] 
 * File creation mode. 
 *
 * Note that if the file exists its mode is left untouched.
 *
 * @returns {void}
 * @throws {SysError}
 */
fs.copy_file = function(from, to, mode) {
	if (mode === undefined) {
		mode = fs.stat(from).mode &amp; 07777;
	}

	var fdFrom;
	var fdTo;

	try {
		fdFrom = io.open(from);
		fdTo = io.truncate(to, mode);

		const buf = new Uint8Array(4096);

		var count;
		while ((count = io.read(fdFrom, buf, buf.length)) !== 0) {
			io.write(fdTo, buf, count);
		}
	}
	catch(err) {
		throw err;
	}
	finally {
		io.close(fdFrom, false);
		io.close(fdTo, false);
	}
}

/**
 * Create a temporary file with a random name
 *
 * @param {string} [contents=''] Initial file contents
 * @param {number} [mode=0600] Creation mode
 * @returns {string} The temporary file path
 * @throws {SysError}
 */
fs.create_temp_file = function(contents, mode) {
	if (typeof contents === 'number') {
		mode = contents;
		contents = undefined;
	}

	contents = contents || '';
	mode = Number(mode || 0600);

	const rnd = math.get_random_bytes(4);
	const filename = 
		'/tmp/joshi_' + 
			proc.getpid().toString(16) + 
			'_' + 
			rnd[0].toString(16) + 
			rnd[1].toString(16) + 
			rnd[2].toString(16) + 
			rnd[3].toString(16);

	fs.write_file(filename, contents, mode);

	return filename;
}

/**
 * Get the directory part of a path
 *
 * @param {string} path
 * @returns {string} A directory or '.' if none was present in parameter
 */
fs.dirname = function(path) {
	const i = path.lastIndexOf('/');

	if (i === -1) {
		return '.';
	}
	else {
		return path.substring(0, i);
	}
}

/**
 * Check if a file path exists
 *
 * @param {string} pathname
 * @returns {boolean}
 * @throws {SysError} If anything goes wrong 
 */
fs.exists = function(pathname) {
	try {
		fs.stat(pathname);

		return true;
	} 
	catch(err) {
		if (err.errno === errno.ENOENT) {
			return false;
		}

		throw err;
	}
}

/**
 * Check if a path points to a block device 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_block_device = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFBLK;
}

/**
 * Check if a path points to a char device 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_char_device = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFCHR;
}

/**
 * Check if a path points to a directory 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_directory = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFDIR;
}

/**
 * Check if a file is executable by current process given its effective gid and
 * uid.
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_executable = function(pathname) {
	return matches_mode(pathname, 01);
}

/**
 * Check if a path points to a FIFO 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_fifo = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFIFO;
}

/**
 * Check if a path points to a regular file 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_file = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFREG;
}

/**
 * Check if a path points to a symbolic link 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_link = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFLNK;
}

/**
 * Check if a file is readable by current process given its effective gid and
 * uid.
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_readable = function(pathname) {
	return matches_mode(pathname, 04);
}

/**
 * Check if a path points to a socket 
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_socket = function(pathname) {
	return (fs.stat(pathname).mode &amp; fs.S_IFMT) === fs.S_IFSOCK;
}

/**
 * Check if a file is writable by current process given its effective gid and
 * uid.
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 */
fs.is_writable = function(pathname) {
	return matches_mode(pathname, 02);
}

/**
 * List items of a directory (not including `.` and `..`).
 *
 * The order of listing is determined by the underlying filesystem.
 *
 * @param {string} name Path of directory
 *
 * @param {ListDirCallback} [callback] 
 * A callback function invoked for each directory item. Use this idiom to avoid
 * having to wait for the whole listing to finish.
 *
 * @return {boolean|string[]} 
 * The list of items or, if a callback is provided, a boolean indicating if the
 * listing finished (true) or was cancelled (false).
 *
 * @throws {SysError}
 */
fs.list_dir = function(name, callback) {
	const items = callback ? undefined : [];
	var finished = false;

	var dirp;

	try {
		const cb = callback 
			? callback
			: function(item) {items.push(item)};

		dirp = j.opendir(name);

		var index = 0;
		while (true) {
			const dirent = j.readdir(dirp);
			const name = dirent.d_name;

			if (name === '.' || name === '..') {
				continue;
			}

			if (cb(name, index++) === false) {
				break;
			}
		}
	}
	catch(err) {
		if (err.errno) {
			err.message += ' (' + name + ')';
			throw err;
		}

		finished = true;
	}
	finally {
		if (dirp) {
			j.closedir(dirp);
		}
	}

	return callback ? finished : items;
}

/**
 * Create a directory
 *
 * @param {string} pathname Path of directory
 * @param {number} [mode=0755] Creation mode
 * @returns {0}
 * @throws {SysError}
 */
fs.mkdir = function(pathname, mode) {
	if (mode === undefined) {
		mode = 0755;
	}

	try {
		return j.mkdir(pathname, mode);
	} 
	catch(err) {
		err.message += ' (' + pathname + ')';
		throw err;
	}
}

/**
 * Create a directory and all parents that are necessary
 *
 * @param {string} pathname Path of directory
 * @param {number} [mode=0755] Creation mode of new directories
 * @returns {0}
 * @throws {SysError} 
 */
fs.mkdirp = function(pathname, mode) {
	var dirname = '';
	var initialIndex = 1;

	if (!pathname.startsWith('/')) {
		dirname = '.';
		initialIndex = 0;
	}

	const parts = pathname.split('/');

	for (var i = initialIndex; i &lt; parts.length; i++) {
		dirname += '/' + parts[i];

		if (!fs.exists(dirname)) {
			fs.mkdir(dirname, mode);
		}
		else if (!fs.is_directory(dirname)) {
			errno.fail(errno.ENOTDIR);
		}
	}	

	return 0;
}

/**
 * Create a FIFO at a given path
 *
 * @param {string} pathname Path of FIFO
 * @param {number} [mode=0644] Creation mode of FIFO
 * @returns {0}
 * @throws {SysError} 
 */
fs.mkfifo = function(pathname, mode) {
	if (mode === undefined) {
		mode = 0644;
	}

	return j.mkfifo(pathname, mode);
}

/**
 * Normalize a path resolving any `.` or `..` inside and making sure it is an
 * absolute path.
 *
 * Note that this function does not return the canonical path (resolving
 * symbolic links), just an absolute path in normalized form.
 *
 * The path does NOT need to exist for the function to work (as opposed to 
 * {@link module:fs.realpath}.
 *
 * @param {string} path The path to normalize
 * @returns {string} An absolute path without any `.` or `..` inside
 */
fs.normalize_path = function(path) {
	if (path[0] !== '/') {
		path = fs.realpath('.') + '/' + path;
	}

	 const nparts = [];

	 path
		 .split('/')
		 .filter(function(part) {return part !== '.'})
		 .forEach(function(part) {
			 if (part === '..') {
				 nparts.pop();
			 }
			 else {
				 nparts.push(part);
			 }
		 });

	return nparts.join('/');
}

/**
 * Get the path referenced by a symbolic link
 *
 * @param {string} path Path to symbolic link
 *
 * @param {boolean} [dereference=true]
 * Whether to dereference link if it is relative
 *
 * @returns {string} The target path
 * @throws {SysError}
 */
fs.read_link = function(path, dereference) {
	if (dereference === undefined) {
		dereference = true;
	}

	// We need to use a buffer because readlink does not add the trailing \0
	const buf = new Uint8Array(384); 

	const length = j.readlink(path, buf, buf.length); 

	buf = buf.subarray(0, length);

	const val = decoder.decode(buf); 

	if (val[0] === '/') {
		return val;
	}

	return fs.dirname(path) + '/' + val;
}

/**
 * Read the contents of a file as an UTF-8 string.
 *
 * @param {string} path Path of file to read
 * @returns {string} The contents of the file as a string
 * @throws {SysError}
 * @see {module:io.read_string}
 */
fs.read_file = function(path) {
	const fd = io.open(path);

	try {
		return io.read_string(fd);
	} 
	finally {
		io.close(fd);
	}
}

/**
 * Get the canonical form of a path (resolving `.`, `..`, and symbolic links)
 *
 * @example
 * // Get the absolute path of the current working directory
 * const cwd = fs.realpath('.');
 *
 * @param {string} path 
 * @returns {string} The canonical path
 * @throws {SysError} If anything goes wrong or path does not exist
 */
fs.realpath = function(path) {
	return j.realpath(path);
}

/**
 * Delete a directory 
 *
 * @param {string} path Path of directory
 * @param {boolean} [recursive=false] Delete even if not empty
 * @returns {0}
 * @throws {SysError} 
 */
fs.rmdir = function(path, recursive) {
	if (recursive === undefined) {
		recursive = false;
	}

	if (recursive &amp;&amp; !fs.exists(path)) {
		return 0;
	}

	if (recursive) {
		fs.list_dir(path, function(item) {
			const item_path = path + '/' + item;

			if (fs.is_directory(item_path)) {
				fs.rmdir(item_path, true);
			}
			else {
				fs.unlink(item_path);
			}
		});
	}

	return j.rmdir(path);
}

/**
 * Obtain information of a file node
 *
 * @param {string} pathname Path of file node
 * @returns {StatBuf} Information on file node
 * @throws {SysError} 
 */
fs.stat = function(pathname) {
	const statbuf = j.lstat(pathname).statbuf;

	return {
		gid: statbuf.st_gid,
		mode: statbuf.st_mode,
		size: statbuf.st_size,
		time: {
			access: statbuf.st_atim.tv_sec,
			creation: statbuf.st_ctim.tv_sec,
			modification: statbuf.st_mtim.tv_sec,
		},
		uid: statbuf.st_uid,
	};
}

/**
 * Delete a file node
 *
 * @param {string} pathname Path of file node
 *
 * @param {boolean} [fail_if_not_found=true]
 * Pass `false` to ignore ENOENT errors
 *
 * @returns {0}
 * @throws {SysError} 
 */
fs.unlink = function(pathname, fail_if_not_found) {
	if (fail_if_not_found === undefined) {
		fail_if_not_found = true;
	}

	try {
		return j.unlink(pathname);
	}
	catch(err) {
		if (!fail_if_not_found &amp;&amp; err.errno === errno.ENOENT) {
			return 0;
		}

		err.message += ' (' + pathname + ')';
		throw err;
	}
}

/**
 * Write a string in UTF-8 format to a file
 *
 * @param {string} path Path to file
 * @param {string} contents Contents of file
 * @param {number} [mode=0644] Creation mode if file needs to be created
 * @returns {number} The number of bytes written
 * @throws {SysError} 
 * @see {@link module:io.write_string}
 */
fs.write_file = function(path, contents, mode) {
	var fd;

	try {
		fd = io.truncate(path, mode);

		return io.write_string(fd, contents);
	} 
	catch(err) {
		err.message += ' (' + path + ')';
		throw err;
	}
	finally {
		if (fd) {
			io.close(fd);
		}
	}
}

/**
 * Check if a file matches a mode bit given current process' effective gid and
 * uid.
 *
 * @param {string} pathname
 * @returns {boolean} 
 * @throws {SysError} If anything goes wrong or the path does not exist
 * @private
 */
function matches_mode(pathname, modebit) {
	const umask = modebit;
	const gmask = modebit &lt;&lt; 3;
	const omask = modebit &lt;&lt; 6; 

	try {
		const stat = fs.stat(pathname);

		if (stat.mode &amp; umask) {
			return true;
		}

		if((stat.mode &amp; gmask) &amp;&amp; (proc.getegid() === stat.gid)) {
			return true;
		}

		if((stat.mode &amp; omask) &amp;&amp; (proc.geteuid() === stat.uid)) {
			return true;
		}

	} catch(err) {
		if ([undefined, 
				errno.EFAULT, 
				errno.ENAMETOOLONG, 
				errno.ENOMEM, 
				errno.EOVERFLOW, 
				errno.EBADFD, 
				errno.EINVAL
			].includes(err.errno)) {

			throw err;
		} else {
			// ignore
		}
	}

	return false;

}

return fs;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Mon Mar 22 2021 20:13:40 GMT+0100 (GMT+01:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
